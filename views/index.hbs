{{!< layout}}

<div class="flex justify-between items-center mb-6">
  <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
    <span class="iconify text-indigo-600" data-icon="mdi:view-dashboard"></span>
    Dashboard Dự Án
  </h2>
  <div class="flex gap-2">
    <button onclick="openAddProjectModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-bold shadow-sm flex items-center gap-2">
      <span class="iconify" data-icon="mdi:plus"></span> Thêm Dự Án
    </button>
    <a href="/settings" class="bg-white hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-lg font-medium border border-gray-200 flex items-center gap-2">
      <span class="iconify" data-icon="mdi:cog"></span> Cấu hình
    </a>
  </div>
</div>

<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
  <table class="w-full text-left text-sm text-gray-600">
    <thead class="bg-gray-50 text-gray-700 uppercase text-xs font-bold">
    <tr>
      <th class="px-6 py-4">Tên Dự Án</th>
      <th class="px-6 py-4">Key</th>
      <th class="px-6 py-4">Scan Gần Nhất</th>
      <th class="px-6 py-4 text-center">Trạng thái</th>
      <th class="px-6 py-4 text-right">Action</th>
    </tr>
    </thead>
    <tbody class="divide-y divide-gray-100">
    {{#each projects}}
      <tr class="hover:bg-gray-50 transition group">
        <td class="px-6 py-4">
          <a href="/project/{{this.id}}" class="font-bold text-gray-900 hover:text-indigo-600 text-base flex items-center gap-2">
            <span class="iconify text-gray-400 group-hover:text-indigo-500" data-icon="mdi:folder-outline"></span>
            {{this.name}}
          </a>
        </td>
        <td class="px-6 py-4">
                    <span class="font-mono text-xs text-indigo-600 bg-indigo-50 px-2 py-1 rounded border border-indigo-100 truncate max-w-[200px] block" title="{{this.key}}">
                      {{this.key}}
                    </span>
        </td>
        <td class="px-6 py-4 text-xs">{{this.lastScan}}</td>
        <td class="px-6 py-4 text-center">
          {{#if this.lastStatus}}
            {{#if (eq this.lastStatus 'COMPLETED')}}<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Hoàn thành</span>
            {{else}}<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">{{this.lastStatus}}...</span>{{/if}}
          {{else}}-{{/if}}
        </td>
        <td class="px-6 py-4 text-right">
          <div class="flex items-center justify-end gap-2">
            <a href="/project/{{this.id}}" class="text-indigo-600 hover:text-indigo-800 font-bold hover:underline">Chi tiết</a>
            <form action="/projects/delete" method="post" onsubmit="return confirm('Xóa?');" class="inline">
              <input type="hidden" name="id" value="{{this.id}}">
              <button class="text-gray-400 hover:text-red-500 p-1"><span class="iconify w-5 h-5" data-icon="mdi:trash-can-outline"></span></button>
            </form>
          </div>
        </td>
      </tr>
    {{/each}}
    </tbody>
  </table>
  {{#unless projects}}<div class="p-10 text-center text-gray-400">Chưa có dự án nào.</div>{{/unless}}
</div>

<div id="addProjectModal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
  <div class="absolute inset-0 bg-gray-900/60 backdrop-blur-sm" onclick="closeAddProjectModal()"></div>
  <div class="relative bg-white rounded-xl shadow-xl w-full max-w-md p-6 transform transition-all scale-100">
    <h3 class="text-lg font-bold text-gray-800 mb-4">Thêm Dự Án Mới</h3>
    <form action="/projects" method="post">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Tên hiển thị</label>
          <input type="text" name="name" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="VD: Core System" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Sonar Project Key</label>
          <input type="text" name="key" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none font-mono text-sm" placeholder="VD: org.company:project" required>
          <p class="text-xs text-gray-500 mt-1">Copy chính xác Key từ SonarQube.</p>
        </div>
      </div>
      <div class="mt-6 flex justify-end gap-3">
        <button type="button" onclick="closeAddProjectModal()" class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 font-medium">Hủy</button>
        <button type="submit" class="px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 font-bold shadow-sm">Tạo Dự Án</button>
      </div>
    </form>
  </div>
</div>

<script>
  function openAddProjectModal() { document.getElementById('addProjectModal').classList.remove('hidden'); }
  function closeAddProjectModal() { document.getElementById('addProjectModal').classList.add('hidden'); }
</script>